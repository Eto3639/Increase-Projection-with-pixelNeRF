# --- Dataset Configuration ---
dataset:
  root_dir: "drr_dataset"         # DRRデータセットのルートディレクトリ
  target_angles: [30, 60] # 学習に使用するターゲット角度
  img_norm_type: "max_val"        # 画像正規化タイプ ("max_val": 最大値で割る, "min_max": [0,1])
  img_size: [224, 224]            # 画像サイズ (H, W)
  data_subset_percentage: 1.0     # ★使用するデータセットの割合 (1.0で全データ使用)
  train_val_split: 0.8            # 訓練データの割合 (残りは検証用)

  # --- ★Data Augmentation ---
  augmentation:
    enabled: true
    brightness: 0.2
    contrast: 0.2

# --- Training Configuration ---
training:
  device: "cuda"                  # "cuda" or "cpu"
  learning_rate: 1.0e-5           # 学習率
  weight_decay: 1.0e-4            # ★正則化のためのWeight Decayを追加
  num_epochs: 200                 # 総エポック数
  batch_size: 1                   # バッチサイズ (GPUメモリに応じて調整)
  patch_size: 32                  # ★パッチベース学習のパッチサイズ
  num_rays_per_batch: 4096        # 1バッチあたりにサンプリングするレイの数 (パッチ学習では無視される)
  save_checkpoint_freq: 20       # チェックポイントを保存するエポック間隔
  val_freq: 20                    # 検証と可視化を実行するエポック間隔
  log_dir: "logs"                 # ログ保存ディレクトリ
  checkpoint_dir: "checkpoints"   # モデルチェックポイント保存ディレクトリ
  visualization_dir: "visualizations" # 可視化画像の保存ディレクトリ
  save_visualizations_locally: false # ★ローカルに可視化画像を保存するかどうか
  visualization_chunk_size: 2048  # 可視化時のチャンクサイズ
  scheduler:
    type: "CosineAnnealingLR"
    T_max: 200 # num_epochsと一致させるのが一般的
    eta_min: 1.0e-6 # 最小学習率
  loss_weights: # 損失の重み
    l1: 1.0
    lpips: 0.5
  lpips_net: 'vgg'               # LPIPSのバックボーン ('alex', 'vgg', 'squeeze')
  early_stopping_patience: 10     # ★早期終了のpatience（このエポック数、検証損失が改善しなければ停止）
  overfit_single_image: false      # ★デバッグ用：単一データへの過学習テスト

# --- Model Configuration (PixelNeRF) ---
model:
  backbone:
    name: "densenet121" # ★CheXNetバックボーンに戻す
    pretrained: true
  n_pos_freqs: 10                 # 位置エンコーディングの周波数
  n_view_freqs: 4                 # ★追加: ビュー方向エンコーディングの周波数
  d_feature: 256                  # 画像特徴量の次元
  d_mlp_width: 128                # NeRF MLPの隠れ層の幅
  n_samples_coarse: 64            # Coarseサンプリング数 (今後の探索候補: メモリ影響あり)
  n_samples_fine: 64             # Fineサンプリング数
  use_fine_model: true            # ★Fineモデルを再度有効化
  dropout_rate: 0.2               # ★MLPのドロップアウト率

# --- Geometry Configuration ---
geometry:
  invert_extrinsics: True        # extrinsics を逆行列にするか (True推奨)
  grid_sample_align_corners: False # F.grid_sample の align_corners 設定

# --- DRR Generation Configuration ---
drr:
  sdd: 1500.0                   # 線源-検出器間距離 (Source-to-Detector Distance)

# --- Experiment Tracking ---
wandb:
  # project: "PixelNeRF_DRR_ver1.3"
  project: "テスト用プロジェクト"
  entity: "yamaguchiuniv" # ★★★ あなたのWandBのentity(ユーザー名 or チーム名)をここに設定してください ★★★
  enabled: true

# --- Hyperparameter Optimization ---
optuna:
  enabled: false
  n_trials: 20 # ★試行回数を増やす
  hyperparameters:
    # --- 今回の探索対象 --- #
    backbone_name:
      type: "categorical"
      choices: 
        - "densenet121"
    learning_rate:
      type: "float"
      low: 1.0e-5
      high: 1.0e-3
      log: true
    weight_decay:
      type: "float"
      low: 1.0e-5
      high: 1.0e-3
      log: true
    d_mlp_width:
      type: "categorical"
      choices: [128, 256]
    d_feature:
      type: "categorical"
      choices: [128, 256]
    lpips_net:
      type: "categorical"
      choices: ["alex", "vgg"]
    # --- 今後の探索対象（参考） --- #
    # n_pos_freqs:
    #   type: "categorical"
    #   choices: [8, 10, 12]
    # num_rays_per_batch:
    #   type: "categorical"
    #   choices: [2048, 4096]
